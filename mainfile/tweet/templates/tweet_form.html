{% extends "layout.html" %}

{% block title %}
{% if form.instance.pk %}Edit Tweet{% else %}Create Tweet{% endif %}
{% endblock title %}

{% block content %}
<div class="row">
  <div class="col-md-8 mx-auto">
    <div class="card">
      <div class="card-header">
        <h2 class="text-center m-0">
          {% if form.instance.pk %}
            <i class="fas fa-edit"></i> Edit Tweet
          {% else %}
            <i class="fas fa-feather-alt"></i> Create New Tweet
          {% endif %}
        </h2>
      </div>
      <div class="card-body">
        <form method="post" enctype="multipart/form-data" class="form">
          {% csrf_token %}
          
          <div class="form-group">
            <label for="id_content">What's happening?</label>
            {{ form.content }}
          </div>
          
          <div class="form-group">
            <label for="id_img_url">Image URL (optional)</label>
            {{ form.img_url }}
            <small class="form-text text-muted">Paste a direct link to an image to include it in your tweet.</small>
          </div>
          
          <div class="media-upload-container">
            <label for="id_img" class="media-upload-label">
              <i class="fas fa-image"></i> Upload Image
              {{ form.img }}
            </label>
            
            <label for="id_video" class="media-upload-label">
              <i class="fas fa-video"></i> Upload Video
              {{ form.video }}
            </label>
          </div>
          
          <div class="media-preview">
            <div class="image-container">
              <img id="image-preview" src="#" alt="Image Preview">
              <div id="image-filename" class="media-filename"></div>
            </div>
            
            <div class="video-container">
              <video id="video-preview" controls>
                <source src="#" type="video/mp4">
                Your browser does not support the video tag.
              </video>
              <div id="video-filename" class="media-filename"></div>
            </div>
          </div>
          
          {% if form.instance.img_url %}
          <div class="form-group mt-3">
            <label>Current Image URL:</label>
            <img src="{{ form.instance.img_url }}" class="img-fluid tweet-img" style="max-height: 200px;">
          </div>
          {% endif %}
          
          {% if form.instance.img %}
          <div class="form-group mt-3">
            <label>Current Uploaded Image:</label>
            <img src="{{ form.instance.img.url }}" class="img-fluid tweet-img" style="max-height: 200px;">
          </div>
          {% endif %}
          
          {% if form.instance.video %}
          <div class="form-group mt-3">
            <label>Current Uploaded Video:</label>
            <video class="img-fluid tweet-video" controls style="max-height: 200px;">
              <source src="{{ form.instance.video.url }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
          {% endif %}
          
          {% if form.errors %}
          <div class="alert alert-danger mt-3">
            <ul>
              {% for field in form %}
                {% for error in field.errors %}
                  <li>{{ field.label }}: {{ error }}</li>
                {% endfor %}
              {% endfor %}
              {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
          
          <div class="form-group mt-4">
            <button class="btn btn-primary btn-block" type="submit">
              {% if form.instance.pk %}
                <i class="fas fa-save"></i> Save Changes
              {% else %}
                <i class="fas fa-paper-plane"></i> Post Tweet
              {% endif %}
            </button>
          </div>
        </form>
        <a href="{% url 'tweet_list' %}" class="btn btn-outline-secondary btn-block mt-3">
          <i class="fas fa-arrow-left"></i> Back to Tweet Feed
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

